
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="shortcut icon" href="http://oa.bbcmad.com/images/favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DataControl_v1</title>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.form.js"></script>

<!--  <script type="text/javascript" language="javascript" src="http://oa.bbcmad.com/js/jquery.min.js"></script>-->

<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/validation/jquery.validationEngine.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/validation/jquery.validationEngine-zh_CN.js"></script>
<!--<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.dataTables-1.10.9.js"></script>-->
<script type="text/javascript" language="javascript"
	src="http://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>	
	
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-dataTables-fnNameOrdering.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-dataTables-fnNoColumnsParams.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/layer/layer.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/icheck.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/platform.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/index.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/common.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/banBackSpace.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.validate.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.ulmenu.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/model.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/bus_mlist.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-ui/jquery-ui.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-dateFormat.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-ui/jquery-ui.auto.complete.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/datepicker.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.datetimepicker.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/progressbar.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/bus-model.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-dataTables-checkboxSelect.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery.mtz.monthpicker.js"></script>

<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/jquery-dataTables-checkboxSelect.js"></script>
<!--增加lay最新版本-->
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/layer-v1.9.3/layer/layer.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/layer.onload.js"></script>
<script type="text/javascript" language="javascript"
	src="http://oa.bbcmad.com/js/layer-v1.9.3/layer-site.js"></script>


<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/sea.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/icheck-green.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/one.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/foot.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/account.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/page.css" media="screen" />
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/js/jquery-ui/jquery-ui.min.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/js/validation/validationEngine.jquery.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/table.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/city.css">
<link rel="stylesheet" type="text/css"
	href="http://oa.bbcmad.com/css/logMini.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/jquery.datetimepicker2.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/sift.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/account.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/js/jquery-ui/jquery-ui.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/uploadprogess.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/jquery-ui-1.8.16.custom.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/js/jquery-ui/jquery-ui.auto.complete.css">
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/autocomplete.css">
<style type="text/css">
.online-support {
	display: none;
	position: fixed;
	bottom: 20px;
	left: 20px;
	width: 80px;
	height: 32px;
}

.ui-form-item {
    padding: 0 0px 0px 0px; 
}


</style>
</head>
<body>
	<div class="page-container">
		<div class="pg-container-main">
			<div class="container-12 mt10 s-clear">
				 

				<!--菜单结束-->

				<!--主体开始-->
				<div class="ls-101">
					
<link rel="stylesheet" type="text/css" href="http://oa.bbcmad.com/css/basecss.css">
<!--datatable select  需要加的样式 --> <!-- jquery.mtz.monthpicker.js  "css/jquery.monthpicker.css"-->
<style type="text/css">
table.dataTable.select tbody tr,
table.dataTable thead th:first-child {
  cursor: pointer;
}
}
</style>
<script type="text/javascript"> 

 
var table2;
var _root;
    var rows_selected = [];
     function up(id){
	    var r =$('#wt').val();
      console.log(r)
      var obj=JSON.parse(r);
      obj.checkUniq='Y';
      obj.selectByField="id"
       obj.id=id;
       console.log(obj);
      saveOrUpdate(obj,'${name}')
    }
    
    function saveOrUpdate(params, toClassName) {
	    var settings = {
	        "async" : false,
	        "crossDomain" : true,
	        "url" : "/common/saveModel?className=" + toClassName ,
	        "method" : "POST",
	        "data" : params
	    }
	    $.ajax(settings).done(function(response) {
	    	console.log(response);
	    	layer.msg("修改成功");
	    	table2.fnDraw();
	    });
	}
	function c(id){ 
		var t= $('#deleteConform').val();
		if(t == 'Y'){
			layer.confirm('您确定要删除该数据吗？', {
			  btn: ['删除','取消'] 
			}, function(){
			 	d(id);
			}, function(){
			});
		} else  {
			d(id);
		}
		
	}
    function d(id){
  		  $.ajax({
				url : "/common/delById?id=" + id
						+ "&className=${name}",
				type : "GET",
				async : false,
				dataType : "json",
				success : function(data) {
					if (data == true) {
						layer.msg("删除成功");
						table2.fnDraw();
					} else {
						layer.msg("删除失败", {
							icon : 5
						});
					}
				}
			});
    }
    function q(id){
  		  $.ajax({
				url : "/common/queryById?className=${name}&id="+id,
				type : "GET",
				async : false,
				dataType : "json",
				success : function(data) {
					 console.log(data);
					 var json = {};
					 if(isNotNull(data.s_Map)){
					  	$.each(data.s_Map, function (k, v) {json[k]=v });
					 }
					  if(isNotNull(data.i_Map)){
					  	$.each(data.i_Map, function (k, v) {json[k]=v });
					 }
					  if(isNotNull(data.dt_Map)){
					  	$.each(data.dt_Map, function (k, v) {
					  	if(k!='updated_dt' && k!='created_dt')	
					  		json[k]=  $.format.date(v , "yyyy-MM-dd") 
					  	
					  	});
					 }
					  if(isNotNull(data.d_Map) ){
					  	$.each(data.d_Map, function (k, v) {json[k]=v });
					 }
					  if(isNotNull(data.listPair) ){
					  	$.each(data.listPair, function (k, v) {
					  		json[k]=v.join(",")
					  	 });
					 }
					 
					 layer.open({
					  type: 1,
					  skin: 'layui-layer-rim', //加上边框
					  area: ['420px', '640px'], //宽高
					  content: ''
												+ '<form id="editPayPlanForm" method="post" action='
												+ '/common/saveModel'
												+ '>'
												+ '<div class="inputs" style="margin-top: 0px;margin-left: 10px;">'
												+ '<input type="hidden" name="id" value="'
												+ id
												+ '"/>'
												+ '<input type="hidden" id ="cc" class="layui-layer-ico layui-layer-close layui-layer-close1"/> '
												+ '<div class="ui-form-item">'
												+ '<textarea rows="25" cols="50" id="wt" data-is="isAmount isEnough" style="resize: none;" name="remarks_s">'
												+ JSON.stringify(json, null, 4)
												+ '</textarea>'
												+ '</div>'
												+ '</div>'
												+ '<div class="widthdrawBtBox" style="position: absolute; bottom: 10px;">'
												+ '<input type="button" onclick="up(\''+id+'\')"; class="block-btn" value="保存" ></div>'
												+ '</form>'
												+ '<div id="worm-tips" class="worm-tips" style="width:350px;display:none;"></div>'
					});
					

				}
			});
    }
    
    
	function initDatePicker(ele){
	$.datetimepicker.setLocale('ch');
		 ele.datetimepicker({
		dayOfWeekStart : 1,
		format:'Y-m-d H:i',
		lang:'ch',
		});
	}
    

      function getUrlParam (name) {  
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");  
            var r = window.location.search.substr(1).match(reg); 
                //if (r != null) return unescape(r[2]); return null;
                if (r != null) return decodeURI(r[2]); return null;
            } 

	 function getP(){
		var p=  "&_1="+$.format.date(new Date(), "yyyyMMddHHmmss");
		//p+="&"+ $('#qt').val();
		console.log( $('#qt').html());
		return p;
	 }
	 function initTable2 () {
        table2 = $('#table2').dataTable( {
           "dom": '<"#toolbar"><"top"il>Bfrt<"bottom"p>',  
              buttons: [
                 {
                        extend: 'excelHtml5',
                        text: '导出excel',
                        className: 'green'
                    },
              ],
            "searching": false,
            "ordering": true,
            "serverSide": true,
            "aaSorting": [[2, "desc"]],
            "columnDefs": [
                 { "orderable": false, "targets": [0] },
            ],
            "scrollX": true,
            "iDisplayLength" : 50,
            "aLengthMenu": [[15,20, 50, 100,200,500,15000], [15,20, 50, 100,200,500,'全部']],
            "ajax": {
                type: "GET",
                url: "/common/getModelList?filter[className]=${name}",
                data: function(d) {
                    return $.extend( {}, d, {
                       "filter[ARQ]" : $('#qt').val(),
                    } );
                },
                "dataSrc": function (json) { 
                    json.recordsTotal=json.totalElements;
                    json.recordsFiltered=json.totalElements;
                    return json.content;
                }
            },
            "columns": [
                { "data": "id", "defaultContent": "", "render": function(data, type, row, meta) {
                   var w=  '<a class="operation" href="javascript:void(0);" onclick="c(\''+row.id+'\');">删除</a>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp';
                   w+=    '<a class="operation" href="javascript:void(0);" onclick="q(\''+row.id+'\');">修改</a>';
                   return w;
                }},
                 { "data": "id", "defaultContent": ""},
                  { "data": "created_dt", "defaultContent": "", "render": function(data) {
                    return data == null ? "" : $.format.date(data, "yyyy-MM-dd HH:mm:ss");
                }},
                  { "data": "updated_dt", "defaultContent": "", "render": function(data) {
                    return data == null ? "" : $.format.date(data, "yyyy-MM-dd HH:mm:ss");
                }},
                
        <#list dt_Map as item>  
		  { "data": "dt_Map.${item}", "defaultContent": "", "render": function(data) {
                    return data == null ? "" : $.format.date(data, "yyyy-MM-dd");
                }},
		</#list>
		
                <#list s_Map as item>  
		 { "data": "s_Map.${item}", "defaultContent": ""},
		</#list>
		
		
		
		
		 <#list d_Map as item>  
		   { "data": "d_Map.${item}", "defaultContent": ""},
		</#list>
		
		 <#list i_Map as item>  
		   { "data": "i_Map.${item}", "defaultContent": ""},
		</#list>
		
		 <#list ss_Map as item>  
		   { "data": "listPair.${item}", "defaultContent": ""},
		</#list>
                 
            ],
            "language": {
                "url": "http://oa.bbcmad.com/js/jquery.dataTables.lang.cn.json?_=1503979495359"
            },
            "initComplete": initComplete,
            "drawCallback": drawCallback,
            "fnDrawCallback": fnDrawCallback2,
             "preDrawCallback": preDrawCallback 
        } );
        table2.fnNameOrdering("orderBy").fnNoColumnsParams();
    }
    
      function preDrawCallback(){
           layer.load();
           if($.trim($("div#toolbar").html()) == ''){
          	 $("div#toolbar").html(
	                '<div>' +
	                        '    <span></span>&nbsp;&nbsp;' +
	                        '<select class="ui-input ui-input-mini" name="table" id="table"  style="width:250px">' +
	                   		'<option value="defaultAll" >所有</option>' +
	                   		 <#list tableList as item>  
	                   		 '<option value="${item}" <#if item=name>selected="selected" </#if>>${item}</option>' +
							</#list>
	         				'</select>' +
	         				 '    <span>删除确认框</span>&nbsp;&nbsp;' +
	                        '<select class="ui-input ui-input-mini" name="deleteConform" id="deleteConform"  style="width:120px">' +
	                   		 '<option value="Y"  >确认</option>' +
	                   		 '<option value="N"  >直接删除</option>' +
	         				'</select><br><br>'+
	         				' <span>eg:name_s_s=1&a_i_i_EQ=77774</span>&nbsp;&nbsp;'+
	         				'	<textarea rows="3" cols="80" id="qt"   '+
   							'  style="BORDER-BOTTOM: 5px solid; BORDER-LEFT: 1px solid; BORDER-RIGHT: 1px solid; BORDER-TOP: 1px solid;" name="remarks_s">'+
								'</textarea>'+
								
	                        '</div>'
	        );		
		    }
     }

    
    
    
	  function initComplete() {
	  layer.closeAll('loading');
	    $('#table').change(function() {
	         window.location.href = "/dataControl_beta/"+ $('#table').val();
        });
        $('#qt').change(function() {
	          table2.fnDraw( );
        });
     }
     
       function drawCallback() {
       layer.closeAll('loading');
    	  $('.table-action').click(function() {
              $.post($(this).attr("url"), function() {
                  table.fnDraw(true);
              })
          });
    }
  //页码跳转
  function jumptoPage2(){
    var pagenum2 = parseInt(document.getElementById('pagenumber2').value);
     $('#table2').dataTable().fnPageChange(pagenum2-1);
  }
    function fnDrawCallback2(){
    layer.closeAll('loading');
    console.log('fnDrawCallback2');
    //页码跳转----------->>
      var tableVar2 = $('#table2').DataTable();
    var currPage2 = tableVar2.page.info().page + 1;
      $("#table2_paginate").append('<span>到第</span><input id="pagenumber2" onkeyup="value=value.replace(/[^\\d]/g,\'\')" style="width:45px" value = "'+currPage2+'"onchange="jumptoPage2()"/>页');
      //页码跳转-----------<<
      trclick();
    }   
			
    $(document).ready(function() {
      var linename = getUrlParam('linename');
      $('#linename').val(linename);

      initTable2();
        //initCheckBoxTools('table',table);
        $("#sh").val("stats_1");
       // initSwift(table);
       // selectModel(table,"draw");
      //  queryDistinct();
        
	$('#monthD').monthpicker({pattern: 'yyyy-mm', 
	    startYear: 2010,
	     monthNames: ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'],
	    finalYear: 2020,});
    } );
</script>
 

<div class="withdraw-wrap color-white-bg fn-clear">
  <div class="withdraw-title">DataControl_v1</div>
  <input type="hidden" id="cid" />
  
  <table id="table2" class="trclick display nowrap" cellspacing="0">
    <thead>
      <tr>
      <th >操作</th>
        <th orderBy="id">id</th>
           <th orderBy="created_dt">created_dt</th>
              <th orderBy="updated_dt">updated_dt</th>
        
		 <#list dt_Map as item>  
		  <th orderBy="${item}">${item}</th>
		</#list>
        
        <#list s_Map as item>  
		  <th orderBy="${item}_s">${item}</th>
		</#list>
		
		
		
		 <#list d_Map as item>  
		   <th orderBy="${item}_d">${item}</th>
		</#list>
		
		 <#list i_Map as item>  
		  <th orderBy="${item}_i">${item}</th>
		</#list>
		
		 <#list ss_Map as item>  
		   <th orderBy="id">${item}</th>
		</#list>


      </tr>
    </thead>
  </table>
  <div id="modelcountView">_ss 字段不支持排序,默认按id排</div>
</div>
 <br>
				</div>
				<!--主体结束-->
			</div>
		</div>
	</div>


</body>
</html>
